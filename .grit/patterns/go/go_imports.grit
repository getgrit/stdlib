language go

pattern before_each_file_prep_imports() {
    $_ where {
        $GLOBAL_NEW_IMPORTS = [],
    }
}

function require_import($source) {
    $GLOBAL_NEW_IMPORTS += [$source],
    return `foo`
}


pattern ensure_import($source) {
    import_declaration(imports=import_spec_list(imports=$mod)) where {
        $mod <: not contains $source,
        $mod += $source
    }
}